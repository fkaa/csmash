#
# Makefile for gmake (It should run with Microsoft's nmake)
#
############################################################################
.SUFFIXES: .exe .so .dll .a .lib .o .obj .cpp .cc .c .asm .s .y .h .l

.c.obj:
	$(CC) $(CFLAGS) $(Cpost) $<
.cpp.obj:
	$(CXX) $(CXXFLAGS) $(CXXpost) $<
.cc.obj:
	$(CXX) $(CXXFLAGS) $(CXXpost) $<

############################################################################
CC = cl -nologo -W3
CXX = $(CC)

Cpost = -c -Tc
CXXpost = -c -Tp

#CFLAGS = -MD -Ox -G6 -vms $(INCDIRS)
CFLAGS = -MD -Ox -G6 -vms -DHAVE_LIBZ $(INCDIRS)

CXXFLAGS=$(CFLAGS) -GX

O = obj
A = lib
SO = dll
EXE = .exe
AOUT = -Fe

############################################################################

INCDIRS = -I.
LIBS =	win32/GetArgs.obj win32/getopt.obj win32/wsaerror.obj \
	win32/wsainit.obj \
	glut32.lib zlib.lib ws2_32.lib

HDRS = \
	Ball.h BallView.h BaseView.h Event.h HitMark.h Howto.h HowtoView.h \
	LoadImage.h PenAttack.h PenDrive.h Player.h PlayerSelect.h \
	PlayerSelectView.h PlayerView.h ShakeCut.h Sound.h Title.h \
	TitleView.h View.h comPenAttack.h comPenDrive.h comPlayer.h \
	comShakeCut.h ttinc.h z.h

SRCS = \
	Ball.cpp BallView.cpp BaseView.cpp Event.cpp HitMark.cpp \
	Howto.cpp HowtoView.cpp LoadImage.cpp PenAttack.cpp \
	PenDrive.cpp Player.cpp PlayerSelect.cpp PlayerSelectView.cpp \
	ShakeCut.cpp Sound.cpp Title.cpp TitleView.cpp PlayerView.cpp \
	View.cpp comPenAttack.cpp comPenDrive.cpp comPlayer.cpp \
	comShakeCut.cpp ComTrainingPenAttack.cpp TrainingPenAttack.cpp \
	MultiPlayer.cpp \
	main.cpp z.cpp parts.cpp xerror.cpp

#	PlayerView.cpp Normal.cpp
OBJS = $(SRCS:.cpp=.obj)

TARGET = csmash$(EXE)

############################################################################
all: $(TARGET)
clean:
	rm -f $(TARGET) *.$(O)
	cd win32; $(MAKE) -f Makefile.nt CFLAGS="$(CFLAGS)" clean
distclean:
	rm -f $(TARGET) *.$(O) *~ *.bak depend.nt
	cd win32; $(MAKE) -f Makefile.nt CFLAGS="$(CFLAGS)" distclean

depend:
	touch depend.nt
	makedepend -fdepend.nt $(INCDIRS) -D_WIN32 -DHAVE_LIBZ *.cpp
	cat depend.nt | sed -e "s/.:\/.*\/VC98[^ ]*include\/[^ ]*//g" \
	| grep -v ".*:[ ]*$$" > depend.new
	mv depend.new depend.nt

$(TARGET): $(OBJS) win32/all
	$(CC) $(CFLAGS) $(AOUT)$@ $(OBJS) $(LIBS)

win32/all:
	cd win32; $(MAKE) -f Makefile.nt CFLAGS="$(CFLAGS)" all

#-include depend.nt
############################################################################
# END
############################################################################
